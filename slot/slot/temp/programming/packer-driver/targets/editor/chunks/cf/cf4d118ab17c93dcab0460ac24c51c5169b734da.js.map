{"version":3,"sources":["file:///C:/Cocos/slot/assets/scripts/controllers/GameController.ts"],"names":["_decorator","Component","Layout","Node","Animation","Label","MusicController","GameService","FunctionUtils","gameService","functionUtils","ccclass","property","GameController","type","layer1Pics","layer2Pics","layer3Pics","bingoTime","throttledStartGame","start","throttle","startGame","bind","initGame","layout1","layout2","layout3","audioManager","playRollingMusic","removeChilds","resetLayout","rollPicture","Promise","all","tweenPictures","then","checkResult","bingoNode","active","playBingoMusic","getChildByName","getComponent","string","toString","goStart","ani","handleBar1","play"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Layout, Node, Prefab, resources, tween, Vec3, Animation, Label } from 'cc';\r\nimport { MusicController } from './MusicController';\r\nimport { GameService } from '../services/GameService';\r\nimport { FunctionUtils } from '../../utils/FunctionUtils';\r\nconst gameService = new GameService()\r\nconst functionUtils = new FunctionUtils()\r\n\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameController')\r\nexport class GameController extends Component {\r\n\r\n    @property({type:Layout})\r\n    private layout1:Layout = null\r\n\r\n    @property({type:Layout})\r\n    private layout2:Layout = null\r\n\r\n    @property({type:Layout})\r\n    private layout3:Layout = null\r\n\r\n    @property({type:Node})\r\n    private handleBar1:Node = null\r\n\r\n    @property({type:MusicController})\r\n    private audioManager:MusicController = null \r\n\r\n    @property({type:Node})\r\n    private bingoNode:Node = null\r\n\r\n    private layer1Pics:Node[] = []\r\n\r\n    private layer2Pics:Node[] = []\r\n\r\n    private layer3Pics:Node[] = []\r\n\r\n    private bingoTime = 0\r\n\r\n    private throttledStartGame:() => void\r\n\r\n\r\n\r\n\r\n    start() {\r\n        this.throttledStartGame = functionUtils.throttle(this.startGame.bind(this), 4000)\r\n\r\n        gameService.initGame(this.layout1, this.layout2, this.layout3, this.layer1Pics, this.layer2Pics, this.layer3Pics)\r\n    }\r\n\r\n    async startGame(){\r\n        this.audioManager.playRollingMusic()\r\n        gameService.removeChilds(this.layout1, this.layer1Pics)\r\n        gameService.removeChilds(this.layout2, this.layer2Pics)\r\n        gameService.removeChilds(this.layout3, this.layer3Pics)\r\n\r\n        gameService.resetLayout(this.layout1)\r\n        gameService.resetLayout(this.layout2)\r\n        gameService.resetLayout(this.layout3)\r\n        \r\n\r\n        await gameService.rollPicture(this.layout1, this.layer1Pics)\r\n        await gameService.rollPicture(this.layout2, this.layer2Pics)\r\n        await gameService.rollPicture(this.layout3, this.layer3Pics)\r\n        \r\n        Promise.all([\r\n\r\n            gameService.tweenPictures(this.layout1),\r\n            gameService.tweenPictures(this.layout2),\r\n            gameService.tweenPictures(this.layout3)\r\n\r\n        ]).then(()=>{\r\n\r\n            if(gameService.checkResult(this.layer1Pics, this.layer2Pics, this.layer3Pics)){\r\n                this.bingoNode.active = true\r\n                this.audioManager.playBingoMusic()\r\n                this.bingoNode.getChildByName('Score').getComponent(Label).string = (++this.bingoTime*100).toString()\r\n            }\r\n\r\n        })\r\n\r\n    }\r\n\r\n\r\n    goStart(){\r\n        let ani = this.handleBar1.getComponent(Animation)\r\n        ani.play('handelbar')\r\n        this.throttledStartGame()\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}