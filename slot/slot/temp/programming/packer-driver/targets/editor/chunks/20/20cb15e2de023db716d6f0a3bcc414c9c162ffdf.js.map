{"version":3,"sources":["file:///C:/WorkSpace/COCOS/slot.github.io/solt/assets/scripts/services/GameService.ts"],"names":["GameService","Vec3","resources","instantiate","Prefab","tween","SlotPicturesEnum","getPicturePath","pictureNumber","checkResult","layer1","layer2","layer3","layer1Result","findLast","item","layer2Result","layer3Result","name","removeChilds","layout","pictureArray","lastNode","node","removeChild","splice","length","resetLayout","setPosition","rollPicture","picutreArray","promises","i","num","Math","floor","random","promise","Promise","resolve","reject","load","err","prefab","newNode","push","nodes","all","shuffledNodes","sort","forEach","index","insertChild","tweenPictures","layoutX","getPosition","x","to","position","easing","call","start"],"mappings":"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","sourcesContent":["import { _decorator, Node, Layout, Vec3, resources, instantiate, Prefab, tween } from 'cc';\r\nimport SlotPicturesEnum from \"../../utils/SlotPicturesEnum\";\r\n\r\nexport class GameService {\r\n\r\n    getPicturePath(pictureNumber:number){\r\n        return SlotPicturesEnum[pictureNumber]\r\n    }\r\n\r\n    checkResult(layer1:Node[], layer2:Node[], layer3:Node[]):boolean{\r\n\r\n        let layer1Result = layer1.findLast((item:Node)=>{\r\n            return item\r\n        })\r\n\r\n        let layer2Result = layer2.findLast((item:Node)=>{\r\n            return item\r\n        })\r\n\r\n        let layer3Result = layer3.findLast((item:Node)=>{\r\n            return item\r\n        })\r\n\r\n        if((layer1Result.name === layer2Result.name) && (layer1Result.name === layer3Result.name)){\r\n            return true\r\n        }else{\r\n            return false\r\n        }\r\n    }\r\n\r\n    removeChilds(layout:Layout, pictureArray:Node[]){\r\n        let lastNode = pictureArray.findLast((item)=>{\r\n            return item\r\n        })\r\n\r\n        for(let node of pictureArray){\r\n            if(node !== lastNode){\r\n                layout.node.removeChild(node)\r\n            }\r\n        }\r\n        pictureArray.splice(0, pictureArray.length-1)\r\n    }\r\n\r\n    resetLayout(layout:Layout){\r\n        layout.node.setPosition(new Vec3(0, 0, 0))\r\n    }\r\n\r\n    async rollPicture(layout:Layout, picutreArray:Node[]){\r\n        const promises = [];\r\n\r\n        for (let i = 0; i < 20; i++) {\r\n            const num = Math.floor(Math.random() * 2 + 1);\r\n\r\n            const promise = new Promise((resolve, reject) => {\r\n                resources.load(`prefabs/${this.getPicturePath(num)}`, Prefab, (err, prefab) => {\r\n                    if (err) {\r\n                        reject(err);\r\n                    } else {\r\n                        const newNode = instantiate(prefab);\r\n                        resolve(newNode);\r\n                    }\r\n                });\r\n            });\r\n\r\n            promises.push(promise);\r\n        }\r\n\r\n        const nodes = await Promise.all(promises);\r\n\r\n        // 打乱顺序\r\n        const shuffledNodes = nodes.sort(() => Math.random() - 0.5);\r\n\r\n        // 插入到布局和数组中\r\n        shuffledNodes.forEach((node, index) => {\r\n            picutreArray.push(node);\r\n            layout.node.insertChild(node, index + 1);\r\n        })\r\n    }\r\n\r\n    tweenPictures(layout:Layout){\r\n\r\n        return new Promise((resolve)=>{\r\n            // 开始 layout 的缓动\r\n            const layoutX = layout.node.getPosition().x;\r\n\r\n            tween(layout.node)\r\n                .to(4, {\r\n                    position: new Vec3(layoutX, 850 * 20, 0),\r\n                }, {\r\n                    easing: 'sineInOut',\r\n                }).call(()=>{\r\n                    resolve(true)\r\n                })\r\n                .start()\r\n        })\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}