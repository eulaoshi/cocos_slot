{"version":3,"sources":["file:///C:/Users/eulao/OneDrive/Desktop/COC/solt/assets/scripts/GameController.ts"],"names":["_decorator","Component","instantiate","Layout","Node","Prefab","resources","tween","Vec3","ccclass","property","GameController","type","layer1Pics","layer2Pics","layer3Pics","playTime","start","load","err","prefab","newNode1","newNode2","newNode3","push","layout1","node","addChild","layout2","layout3","update","deltaTime","startGame","console","log","removeChilds","resetLayout","rollPicture","layout","pictureArray","lastNode","findLast","item","removeChild","splice","length","setPosition","picutreArray","promises","i","num","Math","floor","random","promise","Promise","resolve","reject","newNode","nodes","all","shuffledNodes","sort","forEach","index","insertChild","layoutX","getPosition","x","to","position","easing","error"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;AAAwBC,MAAAA,K,OAAAA,K;AAAaC,MAAAA,I,OAAAA,I;;;;;;;;;OAClG;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;gCAGjBW,c,WADZF,OAAO,CAAC,gBAAD,C,UAGHC,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAACT;AAAN,OAAD,C,UAGRO,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAACT;AAAN,OAAD,C,UAGRO,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAACT;AAAN,OAAD,C,UAGRO,QAAQ,CAAC;AAACE,QAAAA,IAAI,EAACR;AAAN,OAAD,C,2BAZb,MACaO,cADb,SACoCV,SADpC,CAC8C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAclCY,UAdkC,GAclB,EAdkB;AAAA,eAgBlCC,UAhBkC,GAgBlB,EAhBkB;AAAA,eAkBlCC,UAlBkC,GAkBlB,EAlBkB;AAAA,eAoBlCC,QApBkC,GAoBvB,CApBuB;AAAA;;AAsB1CC,QAAAA,KAAK,GAAG;AACJX,UAAAA,SAAS,CAACY,IAAV,CAAgB,IAAhB,EAAqBb,MAArB,EAA6B,CAACc,GAAD,EAAMC,MAAN,KAAe;AACxC,kBAAMC,QAAQ,GAAGnB,WAAW,CAACkB,MAAD,CAA5B;AACA,kBAAME,QAAQ,GAAGpB,WAAW,CAACkB,MAAD,CAA5B;AACA,kBAAMG,QAAQ,GAAGrB,WAAW,CAACkB,MAAD,CAA5B;AAEA,iBAAKP,UAAL,CAAgBW,IAAhB,CAAqBH,QAArB;AACA,iBAAKP,UAAL,CAAgBU,IAAhB,CAAqBF,QAArB;AACA,iBAAKP,UAAL,CAAgBS,IAAhB,CAAqBD,QAArB;AAEA,iBAAKE,OAAL,CAAaC,IAAb,CAAkBC,QAAlB,CAA2BN,QAA3B;AACA,iBAAKO,OAAL,CAAaF,IAAb,CAAkBC,QAAlB,CAA2BL,QAA3B;AACA,iBAAKO,OAAL,CAAaH,IAAb,CAAkBC,QAAlB,CAA2BJ,QAA3B;AACH,WAZD,EADI,CAcZ;AACA;AACA;AACK;;AAEDO,QAAAA,MAAM,CAACC,SAAD,EAAoB,CACzB;;AAEDC,QAAAA,SAAS,GAAE;AACfC,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKrB,UAAjB;AACAoB,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKpB,UAAjB;AACAmB,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKnB,UAAjB;AACQ,eAAKoB,YAAL,CAAkB,KAAKV,OAAvB,EAAgC,KAAKZ,UAArC;AACA,eAAKsB,YAAL,CAAkB,KAAKP,OAAvB,EAAgC,KAAKd,UAArC;AACA,eAAKqB,YAAL,CAAkB,KAAKN,OAAvB,EAAgC,KAAKd,UAArC;AAEA,eAAKqB,WAAL,CAAiB,KAAKX,OAAtB;AACA,eAAKW,WAAL,CAAiB,KAAKR,OAAtB;AACA,eAAKQ,WAAL,CAAiB,KAAKP,OAAtB;AAGA,eAAKQ,WAAL,CAAiB,KAAKZ,OAAtB,EAA+B,KAAKZ,UAApC;AACA,eAAKwB,WAAL,CAAiB,KAAKT,OAAtB,EAA+B,KAAKd,UAApC;AACA,eAAKuB,WAAL,CAAiB,KAAKR,OAAtB,EAA+B,KAAKd,UAApC;AACA,eAAKC,QAAL,GAhBO,CAiBP;AAEH;;AAEDmB,QAAAA,YAAY,CAACG,MAAD,EAASC,YAAT,EAAsB;AAC9B,cAAIC,QAAQ,GAAGD,YAAY,CAACE,QAAb,CAAuBC,IAAD,IAAQ;AACzC,mBAAOA,IAAP;AACH,WAFc,CAAf,CAD8B,CAI9B;;AAEA,eAAI,IAAIhB,IAAR,IAAgBa,YAAhB,EAA6B;AACzB,gBAAGb,IAAI,KAAKc,QAAZ,EAAqB;AACjBF,cAAAA,MAAM,CAACZ,IAAP,CAAYiB,WAAZ,CAAwBjB,IAAxB;AACH;AACJ;;AACDa,UAAAA,YAAY,CAACK,MAAb,CAAoB,CAApB,EAAuBL,YAAY,CAACM,MAAb,GAAoB,CAA3C,EAX8B,CAY9B;AACA;AACH;;AAEDT,QAAAA,WAAW,CAACE,MAAD,EAAQ;AACfA,UAAAA,MAAM,CAACZ,IAAP,CAAYoB,WAAZ,CAAwB,IAAItC,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,CAAxB;AACH;;AAEgB,cAAX6B,WAAW,CAACC,MAAD,EAASS,YAAT,EAAsB;AACnC,gBAAMC,QAAQ,GAAG,EAAjB;;AAEA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AACzB,kBAAMC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgB,CAAhB,GAAoB,CAA/B,CAAZ;AAEA,kBAAMC,OAAO,GAAG,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC7CnD,cAAAA,SAAS,CAACY,IAAV,CAAgB,IAAGgC,GAAI,EAAvB,EAA0B7C,MAA1B,EAAkC,CAACc,GAAD,EAAMC,MAAN,KAAiB;AAC/C,oBAAID,GAAJ,EAAS;AACLsC,kBAAAA,MAAM,CAACtC,GAAD,CAAN;AACH,iBAFD,MAEO;AACH,wBAAMuC,OAAO,GAAGxD,WAAW,CAACkB,MAAD,CAA3B;AACAoC,kBAAAA,OAAO,CAACE,OAAD,CAAP;AACH;AACJ,eAPD;AAQH,aATe,CAAhB;AAWAV,YAAAA,QAAQ,CAACxB,IAAT,CAAc8B,OAAd;AACH;;AAED,cAAI;AACA;AACA,kBAAMK,KAAK,GAAG,MAAMJ,OAAO,CAACK,GAAR,CAAYZ,QAAZ,CAApB,CAFA,CAIA;;AACA,kBAAMa,aAAa,GAAGF,KAAK,CAACG,IAAN,CAAW,MAAMX,IAAI,CAACE,MAAL,KAAgB,GAAjC,CAAtB,CALA,CAOA;;AACAQ,YAAAA,aAAa,CAACE,OAAd,CAAsB,CAACrC,IAAD,EAAOsC,KAAP,KAAiB;AACnCjB,cAAAA,YAAY,CAACvB,IAAb,CAAkBE,IAAlB;AACAY,cAAAA,MAAM,CAACZ,IAAP,CAAYuC,WAAZ,CAAwBvC,IAAxB,EAA8BsC,KAAK,GAAG,CAAtC;AACH,aAHD,EARA,CAaA;;AACA,kBAAME,OAAO,GAAG5B,MAAM,CAACZ,IAAP,CAAYyC,WAAZ,GAA0BC,CAA1C;AAEA7D,YAAAA,KAAK,CAAC+B,MAAM,CAACZ,IAAR,CAAL,CACK2C,EADL,CACQ,CADR,EACW;AACHC,cAAAA,QAAQ,EAAE,IAAI9D,IAAJ,CAAS0D,OAAT,EAAkB,MAAM,EAAxB,EAA4B,CAA5B;AADP,aADX,EAGO;AACCK,cAAAA,MAAM,EAAE;AADT,aAHP,EAMKtD,KANL;AAOH,WAvBD,CAuBE,OAAOE,GAAP,EAAY;AACVc,YAAAA,OAAO,CAACuC,KAAR,CAAc,OAAd,EAAuBrD,GAAvB;AACH;AACJ;;AAnIyC,O;;;;;iBAGjB,I;;;;;;;iBAGA,I;;;;;;;iBAGA,I;;;;;;;iBAGA,I","sourcesContent":["import { _decorator, Component, instantiate, Layout, Node, Prefab, resources, SpriteFrame, tween, Vec2, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('GameController')\r\nexport class GameController extends Component {\r\n\r\n    @property({type:Layout})\r\n    private layout1:Layout = null\r\n\r\n    @property({type:Layout})\r\n    private layout2:Layout = null\r\n\r\n    @property({type:Layout})\r\n    private layout3:Layout = null\r\n\r\n    @property({type:Node})\r\n    private handleBar:Node = null\r\n\r\n    private layer1Pics:[] = []\r\n\r\n    private layer2Pics:[] = []\r\n\r\n    private layer3Pics:[] = []\r\n\r\n    private playTime = 1\r\n\r\n    start() {\r\n        resources.load(`11`, Prefab, (err, prefab)=>{\r\n            const newNode1 = instantiate(prefab)\r\n            const newNode2 = instantiate(prefab)\r\n            const newNode3 = instantiate(prefab)\r\n\r\n            this.layer1Pics.push(newNode1)\r\n            this.layer2Pics.push(newNode2)\r\n            this.layer3Pics.push(newNode3)\r\n\r\n            this.layout1.node.addChild(newNode1)\r\n            this.layout2.node.addChild(newNode2)\r\n            this.layout3.node.addChild(newNode3)\r\n        })\r\n// console.log(this.layer1Pics)\r\n// console.log(this.layer2Pics)\r\n// console.log(this.layer3Pics)\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n    }\r\n\r\n    startGame(){\r\nconsole.log(this.layer1Pics)\r\nconsole.log(this.layer2Pics)\r\nconsole.log(this.layer3Pics)\r\n        this.removeChilds(this.layout1, this.layer1Pics)\r\n        this.removeChilds(this.layout2, this.layer2Pics)\r\n        this.removeChilds(this.layout3, this.layer3Pics)\r\n\r\n        this.resetLayout(this.layout1)\r\n        this.resetLayout(this.layout2)\r\n        this.resetLayout(this.layout3)\r\n        \r\n\r\n        this.rollPicture(this.layout1, this.layer1Pics)\r\n        this.rollPicture(this.layout2, this.layer2Pics)\r\n        this.rollPicture(this.layout3, this.layer3Pics)\r\n        this.playTime++\r\n        // console.log(this.layout1.node.children.length)\r\n\r\n    }\r\n\r\n    removeChilds(layout, pictureArray){\r\n        let lastNode = pictureArray.findLast((item)=>{\r\n            return item\r\n        })\r\n        // console.log(lastNode)\r\n\r\n        for(let node of pictureArray){\r\n            if(node !== lastNode){\r\n                layout.node.removeChild(node)\r\n            }\r\n        }\r\n        pictureArray.splice(0, pictureArray.length-1)\r\n        // console.log(pictureArray.length)\r\n        // console.log(pictureArray[0])\r\n    }\r\n\r\n    resetLayout(layout){\r\n        layout.node.setPosition(new Vec3(0, 0, 0))\r\n    }\r\n\r\n    async rollPicture(layout, picutreArray){\r\n        const promises = [];\r\n\r\n        for (let i = 0; i < 20; i++) {\r\n            const num = Math.floor(Math.random() * 4 + 1);\r\n\r\n            const promise = new Promise((resolve, reject) => {\r\n                resources.load(`1${num}`, Prefab, (err, prefab) => {\r\n                    if (err) {\r\n                        reject(err);\r\n                    } else {\r\n                        const newNode = instantiate(prefab);\r\n                        resolve(newNode);\r\n                    }\r\n                });\r\n            });\r\n\r\n            promises.push(promise);\r\n        }\r\n\r\n        try {\r\n            // 等待所有加载完成\r\n            const nodes = await Promise.all(promises);\r\n\r\n            // 打乱顺序\r\n            const shuffledNodes = nodes.sort(() => Math.random() - 0.5);\r\n\r\n            // 插入到布局和数组中\r\n            shuffledNodes.forEach((node, index) => {\r\n                picutreArray.push(node);\r\n                layout.node.insertChild(node, index + 1);\r\n            });\r\n\r\n            // 开始 layout 的缓动\r\n            const layoutX = layout.node.getPosition().x;\r\n\r\n            tween(layout.node)\r\n                .to(4, {\r\n                    position: new Vec3(layoutX, 850 * 20, 0),\r\n                }, {\r\n                    easing: 'sineInOut',\r\n                })\r\n                .start();\r\n        } catch (err) {\r\n            console.error(\"加载失败:\", err);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}